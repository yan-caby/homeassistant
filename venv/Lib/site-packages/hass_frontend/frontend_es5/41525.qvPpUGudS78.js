"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[41525],{72586:function(e,n,t){t.d(n,{EO:function(){return c},ol:function(){return i},xo:function(){return a}});var r=t(61226),o=t(25786),u=function(e,n,t,o){var u=t((0,r.L_)(e,n),o);return u instanceof Date?(0,r.uk)(u,n):u},i=function(e,n,t,r,i){return t.time_zone===o.Wj.server?u(e,r.time_zone,n,i):n(e,i)},a=function(e,n,t,r,i){return t.time_zone===o.Wj.server?u(e,r.time_zone,n,i):n(e,i)},c=function(e,n,t,u,i){return a(e,t,u,i,u.time_zone===o.Wj.server?(0,r.L_)(n,i.time_zone):n)}},47186:function(e,n,t){t.d(n,{$:function(){return o}});var r=t(66123),o=(t(71936),function(e,n){var t,o={},u=(0,r.A)(e);try{for(u.s();!(t=u.n()).done;){var i=t.value,a=n(i);a in o?o[a].push(i):o[a]=[i]}}catch(c){u.e(c)}finally{u.f()}return o})},60280:function(e,n,t){t.d(n,{JW:function(){return y},TC:function(){return i},VN:function(){return a},Vx:function(){return c},XQ:function(){return _},eM:function(){return f},iH:function(){return s},k3:function(){return p},m4:function(){return o},qf:function(){return u},yv:function(){return l}});var r=t(61780),o=(t(14460),t(43859),33524==t.j?["migration_error","setup_error","setup_retry"]:null),u=33524==t.j?["not_loaded","loaded","setup_error","setup_retry"]:null,i=function(e,n,t){var r={type:"config_entries/subscribe"};return t&&t.type&&(r.type_filter=t.type),e.connection.subscribeMessage((function(e){return n(e)}),r)},a=function(e,n){var t={};return n&&(n.type&&(t.type_filter=n.type),n.domain&&(t.domain=n.domain)),e.callWS(Object.assign({type:"config_entries/get"},t))},c=function(e,n){return e.callWS({type:"config_entries/get_single",entry_id:n})},s=function(e,n,t){return e.callWS(Object.assign({type:"config_entries/update",entry_id:n},t))},f=function(e,n){return e.callApi("DELETE","config/config_entries/entry/".concat(n))},l=function(e,n){return e.callApi("POST","config/config_entries/entry/".concat(n,"/reload"))},_=function(e,n){return e.callWS({type:"config_entries/disable",entry_id:n,disabled_by:"user"})},p=function(e,n){return e.callWS({type:"config_entries/disable",entry_id:n,disabled_by:null})},y=function(e,n){var t=(0,r.A)(e),o=function(e){var t=n[e.domain];return"helper"===(null==t?void 0:t.integration_type)?-1:1};return t.sort((function(e,n){return o(n)-o(e)}))}},41525:function(e,n,t){var r=t(1781),o=t(94881);t.a(e,function(){var e=r(o().mark((function e(r,u){var i,a,c,s,f,l,_,p,y,g,d,m,v,h,b,w,k,T,x,W,D,S,A,j,E,O,P,C,z,L,M,B,N,V,H,X,$,q,I,J,K,Q,G,R,U,F,Y,Z,ee,ne,te,re,oe,ue,ie,ae,ce,se,fe,le,_e,pe,ye,ge,de;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.d(n,{AN:function(){return ie},B2:function(){return ne},BV:function(){return ee},E$:function(){return ue},GW:function(){return Z},KJ:function(){return ye},Q4:function(){return U},RB:function(){return G},WN:function(){return re},X4:function(){return de},_d:function(){return pe},al:function(){return le},bs:function(){return te},c:function(){return Y},m7:function(){return Q},oU:function(){return F},tb:function(){return fe},uh:function(){return R},yM:function(){return ge}}),i=t(539),a=t(61780),c=t(66123),s=t(94881),f=t(1781),l=t(27934),t.n(l),_=t(77052),t.n(_),p=t(53501),t.n(p),y=t(21950),t.n(y),g=t(36724),t.n(g),d=t(71936),t.n(d),m=t(43859),t.n(m),v=t(68113),t.n(v),h=t(84368),t.n(h),b=t(55888),t.n(b),w=t(34517),t.n(w),k=t(56262),t.n(k),T=t(97754),t.n(T),x=t(66274),t.n(x),W=t(84531),t.n(W),D=t(98168),t.n(D),S=t(34290),t.n(S),A=t(8339),t.n(A),j=t(81438),E=t(72502),O=t(57442),P=t(39937),C=t(23177),z=t(94061),L=t(87930),M=t(93352),B=t(79113),N=t(84749),V=t(99955),H=t(72586),X=t(60441),$=t(47186),q=t(60280),I=t(74959),!(J=r([X])).then){e.next=67;break}return e.next=63,J;case 63:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=68;break;case 67:e.t0=J;case 68:X=e.t0[0],K=[],Q=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},G=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},R=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},U=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},F=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},Y=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},Z=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},ee=function(e){return e.callWS({type:"energy/info"})},ne=33524==t.j?function(){var e=(0,f.default)((0,s.default)().mark((function e(n){return(0,s.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",n.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}():null,te=function(e){return e.callWS({type:"energy/get_prefs"})},re=33524==t.j?function(){var e=(0,f.default)((0,s.default)().mark((function e(n,t){var r;return(0,s.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.callWS(Object.assign({type:"energy/save_prefs"},t)),ce(n),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}():null,oe=function(){var e=(0,f.default)((0,s.default)().mark((function e(n,t,r,o,u){var i,a=arguments;return(0,s.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",n.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==u?void 0:u.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:i}));case 2:case"end":return e.stop()}}),e)})));return function(n,t,r,o,u){return e.apply(this,arguments)}}(),ue=function(e){return(0,$.$)(e.energy_sources,(function(e){return e.type}))},ie=function(e,n,t){var r,o=[],u=(0,c.A)(e.energy_sources);try{for(u.s();!(r=u.n()).done;){var i=r.value;if(!t||t.includes(i.type))if("solar"!==i.type)if("gas"!==i.type&&"water"!==i.type)if("battery"!==i.type){var s,f=(0,c.A)(i.flow_from);try{for(f.s();!(s=f.n()).done;){var l=s.value;o.push(l.stat_energy_from),l.stat_cost&&o.push(l.stat_cost);var _=n.cost_sensors[l.stat_energy_from];_&&o.push(_)}}catch(v){f.e(v)}finally{f.f()}var p,y=(0,c.A)(i.flow_to);try{for(y.s();!(p=y.n()).done;){var g=p.value;o.push(g.stat_energy_to),g.stat_compensation&&o.push(g.stat_compensation);var d=n.cost_sensors[g.stat_energy_to];d&&o.push(d)}}catch(v){y.e(v)}finally{y.f()}}else o.push(i.stat_energy_from),o.push(i.stat_energy_to);else{o.push(i.stat_energy_from),i.stat_cost&&o.push(i.stat_cost);var m=n.cost_sensors[i.stat_energy_from];m&&o.push(m)}else o.push(i.stat_energy_from)}}catch(v){u.e(v)}finally{u.f()}return t&&!t.includes("device")||o.push.apply(o,(0,a.A)(e.device_consumption.map((function(e){return e.stat_consumption})))),o},ae=function(){var e=(0,f.default)((0,s.default)().mark((function e(n,t,r,o,u){var f,l,_,p,y,g,d,m,v,h,b,w,k,T,x,W,D,S,A,M,B,N,V,X,$,J,K,Q,G,R,U,F,Y,Z,ne,te,re,ue,ae,ce,se,fe,le,_e,pe,ye,ge;return(0,s.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,q.VN)(n,{domain:"co2signal"}),ee(n)]);case 2:if(f=e.sent,l=(0,i.A)(f,2),_=l[0],p=l[1],!(y=_.length?_[0]:void 0)){e.next=21;break}d=0,m=Object.values(n.entities);case 9:if(!(d<m.length)){e.next=21;break}if("co2signal"===(v=m[d]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((h=n.states[v.entity_id])&&"%"===h.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return g=h.entity_id,e.abrupt("break",21);case 18:d++,e.next=9;break;case 21:b=[],w=(0,c.A)(t.energy_sources);try{for(w.s();!(k=w.n()).done;)if("grid"===(T=k.value).type){x=(0,c.A)(T.flow_from);try{for(x.s();!(W=x.n()).done;)D=W.value,b.push(D.stat_energy_from)}catch(s){x.e(s)}finally{x.f()}}}catch(s){w.e(s)}finally{w.f()}return S=ie(t,p,["grid","solar","battery","gas","device"]),A=ie(t,p,["water"]),M=[].concat((0,a.A)(S),(0,a.A)(A)),B=(0,j.c)(o||new Date,r),N=B>35?"month":B>2?"day":"hour",V=n.config.unit_system.length||"",X={energy:"kWh",volume:"km"===V?"m³":"ft³"},$={volume:"km"===V?"L":"gal"},J=S.length?(0,I.sz)(n,r,o,S,N,X,["change"]):{},K=A.length?(0,I.sz)(n,r,o,A,N,$,["change"]):{},U={},F={},u&&(G=(0,H.xo)(r,E.e,n.locale,n.config)&&(0,H.xo)(o||new Date,O.c,n.locale,n.config)?(0,H.ol)(r,P.P,n.locale,n.config,-(0,H.EO)(o||new Date,r,C.W,n.locale,n.config)-1):(0,H.ol)(r,z.f,n.locale,n.config,-1*(B+1)),R=(0,L.A)(r,-1),S.length&&(U=(0,I.sz)(n,G,R,S,N,X,["change"])),A.length&&(F=(0,I.sz)(n,G,R,A,N,$,["change"]))),void 0!==g&&(Y=oe(n,r,b,g,o,B>35?"month":B>2?"day":"hour"),u&&(Z=oe(n,G,b,g,R,B>35?"month":B>2?"day":"hour"))),ne={},te=M.length?(0,I.Wr)(n,M):[],e.next=42,Promise.all([J,K,U,F,te,Y,Z]);case 42:return re=e.sent,ue=(0,i.A)(re,7),ae=ue[0],ce=ue[1],se=ue[2],fe=ue[3],le=ue[4],_e=ue[5],pe=ue[6],ye=Object.assign(Object.assign({},ae),ce),u&&(Q=Object.assign(Object.assign({},se),fe)),M.length&&le.forEach((function(e){ne[e.statistic_id]=e})),ge={start:r,end:o,startCompare:G,endCompare:R,info:p,prefs:t,stats:ye,statsMetadata:ne,statsCompare:Q,co2SignalConfigEntry:y,co2SignalEntity:g,fossilEnergyConsumption:_e,fossilEnergyConsumptionCompare:pe},e.abrupt("return",ge);case 56:case"end":return e.stop()}}),e)})));return function(n,t,r,o,u){return e.apply(this,arguments)}}(),ce=function(e){K.forEach((function(n){var t=fe(e,{key:n});t.clearPrefs(),t._active&&t.refresh()}))},se=function(e){if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){var n=new Date;n.getMinutes()>=20&&n.setHours(n.getHours()+1),n.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((function(){return e.refresh()}),n.getTime()-Date.now())}},fe=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="_energy";if(n.key){if(!n.key.startsWith("energy_"))throw new Error("Key need to start with energy_");t="_".concat(n.key)}if(e.connection[t])return e.connection[t];K.push(n.key);var r=(0,V.X)(e.connection,t,(0,f.default)((0,s.default)().mark((function n(){return(0,s.default)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.prefs){n.next=4;break}return n.next=3,te(e);case 3:r.prefs=n.sent;case 4:return se(r),n.abrupt("return",ae(e,r.prefs,r.start,r.end,r.compare));case 6:case"end":return n.stop()}}),n)})))),o=r.subscribe;r.subscribe=function(e){var n=o(e);return r._active++,void 0===r._refreshTimeout&&se(r),function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),n()}},r._active=0,r.prefs=n.prefs;var u=new Date,i=(0,X.LW)(u,e.locale,e.config).split(":")[0];r.start=(0,H.ol)("0"===i?(0,z.f)(u,-1):u,M.o,e.locale,e.config),r.end=(0,H.ol)("0"===i?(0,z.f)(u,-1):u,B.D,e.locale,e.config);var a=function n(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,H.ol)(new Date,M.o,e.locale,e.config),r.end=(0,H.ol)(new Date,B.D,e.locale,e.config),n()}),(0,N.L)((0,H.ol)(u,B.D,e.locale,e.config),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(n,t){var o;r.start=n,r.end=t,r.start.getTime()!==(0,H.ol)(new Date,M.o,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,H.ol)(new Date,B.D,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(e){r.compare=e},r},le=function(e){return e.callWS({type:"energy/solar_forecast"})},_e=["volume","energy"],pe=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,c.A)(e.energy_sources);try{for(o.s();!(n=o.n()).done;){var u=n.value;if("gas"===u.type&&(!r||r!==u.stat_energy_from)){var i=t[u.stat_energy_from];if(_e.includes(null==i?void 0:i.unit_class))return i.unit_class}}}catch(a){o.e(a)}finally{o.f()}},ye=function(e,n){var t=pe(n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==t)return"energy"===t?"kWh":"km"===e.config.unit_system.length?"m³":"ft³"},ge=function(e){return"km"===e.config.unit_system.length?"L":"gal"},de="/docs/energy/faq/#troubleshooting-missing-entities",u(),e.next=100;break;case 97:e.prev=97,e.t2=e.catch(0),u(e.t2);case 100:case"end":return e.stop()}}),e,null,[[0,97]])})));return function(n,t){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=41525.qvPpUGudS78.js.map