"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[26222],{94027:function(e,t,a){a.d(t,{E:function(){return h}});var r=a(66123),n=a(36683),s=a(89231),i=a(29864),o=a(83647),c=a(8364),u=a(76504),d=a(80792),l=(a(77052),a(53501),a(21950),a(68113),a(55888),a(34517),a(66274),a(22836),a(8339),a(196)),h=function(e){var t=(0,c.A)(null,(function(e,t){var a=function(t){function a(){var t;(0,s.A)(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t=(0,i.A)(this,a,[].concat(n)),e(t),t}return(0,o.A)(a,t),(0,n.A)(a)}(t);return{F:a,d:[{kind:"field",decorators:[(0,l.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,u.A)((0,d.A)(a.prototype),"connectedCallback",this).call(this),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,u.A)((0,d.A)(a.prototype),"disconnectedCallback",this).call(this),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,u.A)((0,d.A)(a.prototype),"updated",this).call(this,e),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,n=(0,r.A)(e.keys());try{for(n.s();!(t=n.n()).done;){var s=t.value;if(this.hassSubscribeRequiredHostProps.includes(s))return void this.__checkSubscribed()}}catch(i){n.e(i)}finally{n.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},83256:function(e,t,a){a.d(t,{g:function(){return s}});a(64148);var r=a(92849),n=a(1471);function s(e,t,a,s,i,o){var c=e.getPropertyValue(i+"-"+o).trim(),u=c.length>0?c:e.getPropertyValue(i).trim(),d=(0,r.RQ)(u);return 0===c.length&&o&&(d=(0,r.v2)((0,r.BE)(t?(0,n.T)((0,r.Nc)((0,r.xp)(d)),o):(0,n.d)((0,r.Nc)((0,r.xp)(d)),o)))),s?d+=a?"32":"7F":a&&(d+="7F"),d}},72113:function(e,t,a){var r=a(1781),n=a(94881);a.a(e,function(){var e=r(n().mark((function e(r,s){var i,o,c,u,d,l,h,f,_,g,v,y,b;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b=function(e,t,a,r,n,s,i){var o=(0,u.c)(t,e),c=void 0!==s&&void 0!==i;if(c&&o<=35){var g=(0,d.M)(t,e),v=(0,d.M)(i,s);v>g?t=(0,l.L)(t,v-g):g>v&&(i=(0,l.L)(i,g-v))}var b={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:e.getTime(),max:y(o,t),adapters:{date:{locale:a,config:r}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:o>35?"monthyear":o>7?"date":o>2?"weekday":o>0?"datetime":"hour",minUnit:o>35?"month":o>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:n},ticks:{beginAtZero:!0,callback:function(e){return(0,h.ZV)(Math.abs(e),a)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(o>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(c?"".concat((0,f.sl)(t,a,r),": "):"").concat((0,_.fU)(t,a,r)," â€“ ").concat((0,_.fU)((0,l.L)(t,1),a,r))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,h.ZV)(e.parsed.y,a)," ").concat(n)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,h.Yf)(a)};return c&&(b.scales.xAxisCompare=Object.assign(Object.assign({},b.scales.x),{},{suggestedMin:s.getTime(),max:y(o,i),display:!1})),b},y=function(e,t){var a=new Date(t);return e>2&&0===a.getHours()&&(a=(0,c.O)(a,1)),a.setMinutes(0,0,0),e>35&&a.setDate(1),e>2&&a.setHours(0),a.getTime()},a.d(t,{o:function(){return b}}),i=a(77052),a.n(i),o=a(43859),a.n(o),c=a(81408),u=a(81438),d=a(28252),l=a(84749),h=a(56601),f=a(77396),_=a(60441),!(g=r([f,_])).then){e.next=23;break}return e.next=19,g;case 19:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=24;break;case 23:e.t0=g;case 24:v=e.t0,f=v[0],_=v[1],s(),e.next=33;break;case 30:e.prev=30,e.t2=e.catch(0),s(e.t2);case 33:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(t,a){return e.apply(this,arguments)}}())},26222:function(e,t,a){var r=a(1781),n=a(94881);a.a(e,function(){var e=r(n().mark((function e(r,s){var i,o,c,u,d,l,h,f,_,g,v,y,b,p,k,m,x,A,w,O,S,j,C,E,M,D,z,P,H,R,I,q,V,Z,F,N,U,T,L,W,B,G,Q,Y,$,J,K,X,ee,te,ae,re,ne,se,ie,oe,ce,ue,de,le,he;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a.r(t),a.d(t,{HuiEnergyUsageGraphCard:function(){return he}}),i=a(539),o=a(94881),c=a(61780),u=a(1781),d=a(66123),l=a(6238),h=a(36683),f=a(89231),_=a(29864),g=a(83647),v=a(8364),y=a(77052),a.n(y),b=a(69466),a.n(b),p=a(35848),a.n(p),k=a(53501),a.n(k),m=a(21950),a.n(m),x=a(71936),a.n(x),A=a(14460),a.n(A),w=a(650),a.n(w),O=a(43859),a.n(O),S=a(21968),a.n(S),j=a(1158),a.n(j),C=a(68113),a.n(C),E=a(84368),a.n(E),M=a(57733),a.n(M),D=a(56262),a.n(D),z=a(66274),a.n(z),P=a(85038),a.n(P),H=a(84531),a.n(H),R=a(22836),a.n(R),I=a(15445),a.n(I),q=a(24483),a.n(q),V=a(13478),a.n(V),Z=a(46355),a.n(Z),F=a(14612),a.n(F),N=a(53691),a.n(N),U=a(48455),a.n(U),T=a(34290),a.n(T),L=a(8339),a.n(L),W=a(40133),B=a(42180),G=a(79581),Q=a(40924),Y=a(196),$=a(69760),J=a(45081),K=a(83256),X=a(56601),a(43690),a(54373),ee=a(41525),te=a(74959),ae=a(94027),re=a(15821),ne=a(72113),!(se=r([ee,ne])).then){e.next=94;break}return e.next=90,se;case 90:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=95;break;case 94:e.t0=se;case 95:ie=e.t0,ee=ie[0],ne=ie[1],le={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},he=(0,v.A)([(0,Y.EM)("hui-energy-usage-graph-card")],(function(e,t){var a,r=function(t){function a(){var t;(0,f.A)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return t=(0,_.A)(this,a,[].concat(n)),e(t),t}return(0,g.A)(a,t),(0,h.A)(a)}(t);return{F:r,d:[{kind:"field",decorators:[(0,Y.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,Y.wk)()],key:"_start",value:function(){return(0,W.R)()}},{kind:"field",decorators:[(0,Y.wk)()],key:"_end",value:function(){return(0,B.o)()}},{kind:"field",decorators:[(0,Y.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,Y.wk)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,ee.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,re.xP)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,Q.qy)(oe||(oe=(0,l.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,Q.qy)(ce||(ce=(0,l.A)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,$.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(e){return e.data.length}))?"":(0,Q.qy)(ue||(ue=(0,l.A)(['<div class="no-data"> '," </div>"])),(0,G.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):Q.s6}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,J.A)((function(t,a,r,n,s,i){var o=(0,ne.o)(t,a,r,n,"kWh",s,i),c=Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{itemSort:function(e,t){var a,r,n,s,i;return(null===(a=e.raw)||void 0===a?void 0:a.y)>0&&(null===(r=t.raw)||void 0===r?void 0:r.y)<0?-1:(null===(n=t.raw)||void 0===n?void 0:n.y)>0&&(null===(s=e.raw)||void 0===s?void 0:s.y)<0?1:(null===(i=e.raw)||void 0===i?void 0:i.y)>0?t.datasetIndex-e.datasetIndex:e.datasetIndex-t.datasetIndex},callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(t){var a,n=0,s=0,i=(0,d.A)(t);try{for(i.s();!(a=i.n()).done;){var o=a.value,c=o.dataset.data[o.dataIndex].y;c>0?n+=c:s+=Math.abs(c)}}catch(u){i.e(u)}finally{i.f()}return[n?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,X.ZV)(n,r)}):"",s?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,X.ZV)(s,r)}):""].filter(Boolean)}})})})});return c}))}},{kind:"method",key:"_getStatistics",value:(a=(0,u.default)((0,o.default)().mark((function e(t){var a,r,n,s,i,u,l,h,f,_,g,v,y,b;return(0,o.default)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r={},n=(0,d.A)(t.prefs.energy_sources),e.prev=3,n.s();case 5:if((s=n.n()).done){e.next=21;break}if("solar"!==(i=s.value).type){e.next=10;break}return r.solar?r.solar.push(i.stat_energy_from):r.solar=[i.stat_energy_from],e.abrupt("continue",19);case 10:if("battery"!==i.type){e.next=13;break}return r.to_battery?(r.to_battery.push(i.stat_energy_to),r.from_battery.push(i.stat_energy_from)):(r.to_battery=[i.stat_energy_to],r.from_battery=[i.stat_energy_from]),e.abrupt("continue",19);case 13:if("grid"===i.type){e.next=15;break}return e.abrupt("continue",19);case 15:u=(0,d.A)(i.flow_from);try{for(u.s();!(l=u.n()).done;)h=l.value,r.from_grid?r.from_grid.push(h.stat_energy_from):r.from_grid=[h.stat_energy_from]}catch(o){u.e(o)}finally{u.f()}f=(0,d.A)(i.flow_to);try{for(f.s();!(_=f.n()).done;)g=_.value,r.to_grid?r.to_grid.push(g.stat_energy_to):r.to_grid=[g.stat_energy_to]}catch(o){f.e(o)}finally{f.f()}case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),n.e(e.t0);case 26:return e.prev=26,n.f(),e.finish(26);case 29:v=getComputedStyle(this),y={},Object.keys(le).forEach((function(e){y[e]={},"used_grid"!==e&&"used_solar"!==e&&"used_battery"!==e&&r[e]&&Object.values(r[e]).forEach((function(t,a){y[e][t]=a}))})),b={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=t.start,this._end=t.end||(0,B.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,a.push.apply(a,(0,c.A)(this._processDataSet(t.stats,t.statsMetadata,r,y,v,b,!1))),t.statsCompare&&(a.push({order:0,data:[]}),a.push({order:999,data:[],xAxisID:"xAxisCompare"}),a.push.apply(a,(0,c.A)(this._processDataSet(t.statsCompare,t.statsMetadata,r,y,v,b,!0)))),this._chartData={datasets:a};case 40:case"end":return e.stop()}}),e,this,[[3,23,26,29]])}))),function(e){return a.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,a,r,n,s){var o,c=this,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=[],h={},f={};Object.entries(a).forEach((function(t){var a=(0,i.A)(t,2),r=a[0],n=a[1],s=["solar","to_grid","from_grid","to_battery","from_battery"].includes(r),c=!["solar","from_battery"].includes(r),u={},d={};n.forEach((function(t){var a=e[t];if(a){var r={};a.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;s&&(u[e.start]=e.start in u?u[e.start]+t:t,o=e.end),c&&!(e.start in r)&&(r[e.start]=t,o=e.end)}})),d[t]=r}})),s&&(f[r]=u),c&&(h[r]=d)}));var _={},g={};if((f.to_grid||f.to_battery)&&f.solar){for(var v={},y=0,b=Object.keys(f.solar);y<b.length;y++){var p,k,m=b[y];if(v[m]=(f.solar[m]||0)-((null===(p=f.to_grid)||void 0===p?void 0:p[m])||0)-((null===(k=f.to_battery)||void 0===k?void 0:k[m])||0),v[m]<0){var x,A,w;if(f.to_battery)if(_[m]=-1*v[m],_[m]>((null===(x=f.from_grid)||void 0===x?void 0:x[m])||0))g[m]=_[m]-((null===(A=f.from_grid)||void 0===A?void 0:A[m])||0),_[m]=null===(w=f.from_grid)||void 0===w?void 0:w[m];v[m]=0}}h.used_solar={used_solar:v}}if(f.from_battery)if(f.to_grid){for(var O={},S=0,j=Object.keys(f.from_battery);S<j.length;S++){var C=j[S];O[C]=(f.from_battery[C]||0)-(g[C]||0)}h.used_battery={used_battery:O}}else h.used_battery={used_battery:f.from_battery};if(h.from_grid&&f.to_battery){for(var E={},M=function(){for(var e,t=z[D],a=0,r=0,n=Object.entries(h.from_grid);r<n.length;r++){var s=(0,i.A)(n[r],2),o=s[0];if(s[1][t]&&(e=o,a++),a>1)break}if(1===a)h.from_grid[e][t]-=_[t]||0;else{var c=0;Object.values(h.from_grid).forEach((function(e){c+=e[t]||0,delete e[t]})),E[t]=c-(_[t]||0)}},D=0,z=Object.keys(_);D<z.length;D++)M();h.used_grid={used_grid:E}}var P=[];Object.values(h).forEach((function(e){Object.values(e).forEach((function(e){P=P.concat(Object.keys(e))}))}));var H=Array.from(new Set(P)).sort((function(e,t){return Number(e)-Number(t)}));return Object.entries(h).forEach((function(e){var a=(0,i.A)(e,2),f=a[0],_=a[1];Object.entries(_).forEach((function(e,a){var _,g,v,y=(0,i.A)(e,2),b=y[0],p=y[1],k=[],m=(0,d.A)(H);try{for(m.s();!(v=m.n()).done;){var x=v.value,A=p[x]||0;k.push({x:Number(x),y:A&&["to_grid","to_battery"].includes(f)?-1*A:A})}}catch(w){m.e(w)}finally{m.f()}1===k.length&&k.push({x:o,y:0}),l.push({label:f in s?s[f]:(0,te.$O)(c.hass,b,t[b]),order:"used_solar"===f?1:"to_battery"===f?Object.keys(h).length:a+2,borderColor:(0,K.g)(n,c.hass.themes.darkMode,!1,u,le[f],null===(_=r[f])||void 0===_?void 0:_[b]),backgroundColor:(0,K.g)(n,c.hass.themes.darkMode,!0,u,le[f],null===(g=r[f])||void 0===g?void 0:g[b]),stack:"stack",data:k,xAxisID:u?"xAxisCompare":void 0})}))})),l}},{kind:"get",static:!0,key:"styles",value:function(){return(0,Q.AH)(de||(de=(0,l.A)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"])))}}]}}),(0,ae.E)(Q.WF)),s(),e.next=106;break;case 103:e.prev=103,e.t2=e.catch(0),s(e.t2);case 106:case"end":return e.stop()}}),e,null,[[0,103]])})));return function(t,a){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=26222.kbKTaWa_Wlk.js.map